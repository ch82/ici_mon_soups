<!DOCTYPE html>
<html lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<title>Журнал событий</title>
	<link href="css/bootstrap.min.css" rel="stylesheet">
	<link href="css/datepicker.css" rel="stylesheet">
	<link href="css/style.css" rel="stylesheet">
	<script src="js/jquery.js"></script>
    <script src="js/bootstrap.min.js"></script>
	<script src="js/bootstrap-datepicker.js"></script>
	<script src="js/logs.js"></script>
	<script src="js/stats.js"></script>
	<style id="calmodstyle"></style>
	<!--[if lt IE 9]>
		<script src="js/html5.js"></script>
	<![endif]-->
	<script>
		var calmod = 'day', repmod = 'logs'
		function onChange(){
			var datepick = $("#datepicker").data().datepicker
			var currdate = datepick.date
			switch (calmod) {
				case 'month':
					datepick.startViewMode=1
					datepick.minViewMode=1
					if (repmod == 'logs')
						renderLog(getMonthLog(currdate.getFullYear(),currdate.getMonth()+1))
					if (repmod == 'stat')
						renderStat(getMonthStat(currdate.getFullYear(),currdate.getMonth()+1))
					break;
				case 'day':
					datepick.startViewMode=0
					datepick.minViewMode=0
					if (repmod == 'logs')
						renderLog(getDayLog(new Date(currdate)))
					if (repmod == 'stat')
						renderStat(getDayStat(new Date(currdate)))
					break
			}
		}

		function calmodclick(t){
			calmod = t
			onChange()
		}
		function repmodclick(t){
			repmod = t
			onChange()
		}
		function renderLog(logs){
			$("#stat").parent().hide()
			$("#logs").parent().show()
			$("#logs").html("")
			var str = ''
			for (var li in logs) {
				for (var lj in logs[li]){
					var l=logs[li][lj]
					var status = l.state.toLowerCase()
					str += "<tr><td class=t_center>"+l.time.toLocaleString()+'</td><td class=t_center>'+l.host +'</td><td class=t_center>'+
						 "<div class='status_block on'><span class='label label-"+ status +"'><i class='icon-arrow-"+ status +" icon-white'></i>"+ l.state +"</span></div>"
						+'</td><td class=t_center>'+ l.duration/1000+'s'+"</td></tr>"
				}
			}
			$("#logs").html(str)
		}
		function renderStat(stat){
			$("#logs").parent().hide()
			$("#stat").parent().show()
			$("#stat").html("")
			var str = ''
			for (host in stat) {
				var hs = stat[host]
				str += '<tr>'+'<td>'+host+'</td>'+'<td>'+hs.summary/1000+'</td>'+'<td>'+hs.maxdur/1000+'</td>'+'<td>'+hs.countsum+'</td>'+'<td>'+hs.count30m+'</td>'+'<td>'+hs.count3h+'</td>'+'<td>'+hs.count6h+'</td>'+'</tr>'
			}
			$("#stat").html(str)
		}
		$(function() {
			$( "#datepicker").datepicker({/*viewMode:'months',minviewMod:'days',*/ format:'dd.mm.yyyy'}).on(
				'changeDate', function(ev){
					onChange()
				}
			)
		});
	</script>
</head>
<body>
	<div class="container">
	<div class="row">
		<form>
			<input type = "radio" name = "reportmod" onclick = "repmodclick('logs')" checked = "checked">Логи
			<input type = "radio" name = "reportmod" onclick = "repmodclick('stat')">Статистика
			<p>
			<input type="radio" name="calmod" onclick="calmodclick('day')" checked = "checked">День
			<input type="radio" name="calmod" onclick="calmodclick('month')">Месяц
			<p>
			<p>Date:<div> <input id="datepicker" type="text" class="span2" value="12-02-2012" ></div>
			</p>
			<button class="btn btn-warning" onclick = "onChange()" type="button">Обновить</button>
		</form>

		<div class="statuses_wrapper table-bordered table-hover table-condensed">
			<table class="table" style="display:none;">
			<thead><th>Время</th><th>Узел</th><th>Состояние</th><th>Длительность</th></thead>
			<tbody id="logs"></tbody>
			</table>
			<table class="table" style="display:none;">
			<thead><tr><th rowspan="2">Узел</th><th colspan="2">Время простоя</th><th colspan="4">Количество потерь</th></tr><tr><th>Сумма</th><th>Максимальное</th><th>Всего</th><th><30м</th><th>>3ч<th>>6ч</th></tr></thead>
			<tbody id="stat"></tbody>
			</table>
		</div>
		  <div class="span6">
		  </div>
		</div>
	</div>
</body>
</html>
